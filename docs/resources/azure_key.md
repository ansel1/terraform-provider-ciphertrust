---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_azure_key Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-

---

# ciphertrust_azure_key (Resource)

This resource provides for the following:

- Creating an Azure key in Azure
- Creating an Azure key by uploading an existing HSM, DSM or CipherTrust CM key


## Example Usage

The following examples assume this script snippet as a prefix.

```hcl
resource "ciphertrust_azure_connection" "connection" {
  name = "azure_connection_name"
}

data "ciphertrust_azure_account_details" "subscriptions" {
  azure_connection = ciphertrust_azure_connection.connection.name
}

resource "ciphertrust_azure_vault" "standard_vault" {
  azure_connection = ciphertrust_azure_connection.connection.name
  subscription_id  = data.ciphertrust_azure_account_details.subscriptions.subscription_id
  name             = "azure_vault_name"
}
```

### Basic Create Key Usage

This example creates a key in Azure.

```hcl
resource "ciphertrust_azure_key" "azure_key" {
  key_type = "EC"
  name     = "key_name"
  vault    = ciphertrust_azure_vault.standard_vault.id
}
```

### Upload Key Usage

This example uploads a HSM key to Azure.

```hcl
resource "ciphertrust_hsm_server" "hsm_server" {
  hostname        = "10.123.45.67"
  hsm_certificate = "hsm-server.pem"
}

resource "ciphertrust_hsm_connection" "hsm_connection" {
  hostname      = "10.123.45.67"
  partitions  {
      partition_label = "partition_label"
      serial_number   = "9999999999999"
  }
  name               = "hsm_connection_name"
  partition_password = "hsm_partition_password"
  server_id          = ciphertrust_hsm_server.hsm_server.id
}

resource "ciphertrust_hsm_partition" "hsm_partition" {
  hsm_connection = ciphertrust_hsm_connection.hsm_connection.id
}

resource "ciphertrust_hsm_key" "hsm_key" {
  attributes   = ["CKA_ENCRYPT", "CKA_DECRYPT"]
  mechanism    = "CKM_RSA_FIPS_186_3_AUX_PRIME_KEY_PAIR_GEN"
  partition_id = ciphertrust_hsm_partition.hsm_partition.id
  key_size     = 2048
}

resource "ciphertrust_azure_key" "azure_key" {
  name = "key_name"
  upload_key {
    hsm_key_id      = ciphertrust_hsm_key.hsm_key.private_key_id
    source_key_tier = "hsm-luna"
  }
  vault = ciphertrust_azure_vault.standard_vault.id
}

```

### Enable Key Rotation Usage

This examples schedules a key for rotation using a Luna-HSM as the key source.

```hcl
resource "ciphertrust_hsm_server" "hsm_server" {
  hostname        = var.hsm_hostname
  hsm_certificate = var.hsm_certificate
}

resource "ciphertrust_hsm_connection" "hsm_connection" {
  hostname      = var.hsm_hostname
  server_id     = ciphertrust_hsm_server.hsm_server.id
  name          = "hsm_connection_name"
  partitions {
      partition_label = "partition_label"
      serial_number   = "serial_number"
  }
  partition_password = var.hsm_partition_password
}

resource "ciphertrust_hsm_partition" "hsm_partition" {
  hsm_connection = ciphertrust_hsm_connection.hsm_connection.id
}

resource "ciphertrust_scheduler" "rotation_job" {
  key_rotation_params {
    cloud_name = "AzureCloud"
  }
  name       = "scheduled_rotation_name"
  run_at     = "0 9 * * sat"
}

resource "ciphertrust_azure_key" "azure_key" {
  enable_rotation {
    hsm_partition_id = ciphertrust_hsm_partition.hsm_partition.id
    job_config_id    = ciphertrust_scheduler.rotation_job.id
    key_source       = "hsm-luna"
  }
  name     = "key_name"
  vault    = ciphertrust_azure_vault.standard_vault.id
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- **name** (String) Name for the key.
- **vault** (String) Name or ID of the vault.

### Optional

- **activation_date** (String) Date of key activation in UTC time in RFC3339 format. For example, 2021-07-03T14:24:30Z.
- **curve** (String) Curve name for an EC or EC-HSM elliptical key. Options: P-256, P-384, P-521, SECP256K1. Default is P-256.
- **enable_key** (Boolean) Enable or disable the key. Default is true.
- **enable_rotation** (Block List, Max: 1) Enable the key for scheduled rotation job. Note: Key rotation can cause drift. (see [below for nested schema](#nestedblock--enable_rotation))
- **expiration_date** (String) Date of key expiry in UTC time in RFC3339 format. for example, 2022-07-03T14:24:00Z.
- **key_ops** (List of String) Allowed key operations. RSA/RSA-HSM key options: encrypt, decrypt, sign, verify, wrapKey, unwrapKey and import. EC key options: sign and verify. Import is applicable only for RSA-HSM keys and mandatory to be set when creating a Key Encryption Key. Default for RSA keys is encrypt, decrypt, sign, verify, wrapKey and unwrapKey. Default for EC keys is sign and verify.
- **key_size** (Number) Size for RSA keys. Options: 2048, 3072, 4096. Default is 2048.
- **key_type** (String) The type of key to create. EC      - Elliptic Curve key, RSA     - RSA key, EC-HSM  - Elliptic Curve key for premium key vaults only, RSA-HSM - RSA key for premium key vaults only. Default is RSA.
- **tags** (Map of String) A list of key:value pairs to assign to the key.
- **upload_key** (Block List, Max: 1) Key upload details. (see [below for nested schema](#nestedblock--upload_key))

### Read-Only

- **id** (String) Concatenation of vault name and key name.
- **key_id** (String) CipherTrust Key ID.
- **kid** (String) Key identifier.
- **version** (String) Version of the key.
- **version_count** (Number) Number of versions of the key.

<a id="nestedblock--enable_rotation"></a>
### Nested Schema for `enable_rotation`

Required:

- **job_config_id** (String) ID of the scheduler job that will perform key rotation.
- **key_source** (String) Source of the key material. Only native is valid for EC keys. Options: native, ciphertrust, dsm and hsm-luna.

Optional:

- **dsm_domain_id** (String) ID of the domain in which DSM keys will be created.
- **enable_key** (Boolean) Enable the rotated key. Default is true.
- **hsm_partition_id** (String) ID of the partition in which HSM keys will be created.


<a id="nestedblock--upload_key"></a>
### Nested Schema for `upload_key`

Optional:

- **dsm_key_id** (String) DSM key ID to upload to Azure. Required if source_key_tier is dsm.
- **hsm** (Boolean) Premium vaults support hsm-backed keys. Set to true to use this option.
- **hsm_key_id** (String) Luna-HSM key identifier of the key to be uploaded to Azure. Required if source_key_tier is hsm-luna
- **kek_kid** (String) Identifier of an Azure key encrypting key.
- **local_key_id** (String) CCKM key identifier of the key uploaded to Azure. Required if source_key_tier is local.
- **pfx** (String) Pfx file to upload. Required if source_key_tier is pfx.
- **pfx_password** (String) PFX password. Specify only if the PFX certificate is provided.
- **source_key_tier** (String) Options: local, pfx, dsm and hsm-luna. Default is local.


